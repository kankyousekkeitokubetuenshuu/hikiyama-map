<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>曳山通り 分類マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    /* 透明度スライダーUI */
    .opacity-control {
      background: white;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      font-size: 13px;
      line-height: 1.2;
    }
    .opacity-control label { display: block; margin-bottom: 6px; font-weight: 600; }
    .opacity-control input[type="range"] { width: 180px; }
    .opacity-value { margin-top: 6px; opacity: 0.8; }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    // =========================
    // PNGの範囲（あなたの最新座標）
    // =========================
    const imageBounds = [
      [33.44243, 129.96037], // 左下（南西）
      [33.45704, 129.98144]  // 右上（北東）
    ];

    // =========================
    // 地図作成：可動範囲をPNGに固定
    //  - maxBounds: 範囲外にパンできない
    //  - maxBoundsViscosity: 1.0で完全固定
    //  - minZoom: 引きすぎ防止（重要）
    // =========================
    const map = L.map('map', {
      maxBounds: imageBounds,
      maxBoundsViscosity: 1.0
    });

    // 背景地図（OSM）
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // PNGオーバーレイ
    const overlay = L.imageOverlay('hikiyama_overlay.png', imageBounds, { opacity: 0.8 }).addTo(map);

    // PNG範囲にぴったり合わせて初期表示
    map.fitBounds(imageBounds);

    // =========================
    // 引きすぎ（ズームアウト）防止
    //  - PNGが画面に入るfitBounds時のズームを「最小ズーム」に固定
    //  - これでそれ以上引けない
    // =========================
    const fitZoom = map.getZoom();   // fitBounds後のズーム
    map.setMinZoom(fitZoom);         // それ以上ズームアウト不可

    // ついでに寄りすぎも制限したい場合（任意）
    // map.setMaxZoom(fitZoom + 4);

    // レイヤ切り替え（任意：ON/OFF）
    L.control.layers(null, { '分類map': overlay }, { collapsed: false }).addTo(map);

    // =========================
    // 透明度スライダー（Leaflet Control）
    // =========================
    const OpacityControl = L.Control.extend({
      onAdd: function() {
        const div = L.DomUtil.create('div', 'opacity-control');
        div.innerHTML = `
          <label>分類map透明度</label>
          <input id="opacityRange" type="range" min="0" max="100" value="80" />
          <div class="opacity-value">透明度: <span id="opacityValue">80</span>%</div>
        `;
        L.DomEvent.disableClickPropagation(div);
        return div;
      }
    });

    map.addControl(new OpacityControl({ position: 'topright' }));

    // スライダーの挙動
    const range = document.getElementById('opacityRange');
    const valueSpan = document.getElementById('opacityValue');

    range.addEventListener('input', () => {
      const v = Number(range.value);
      valueSpan.textContent = String(v);
      overlay.setOpacity(v / 100);
    });
  </script>
</body>
</html>
